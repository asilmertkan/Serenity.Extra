import{a as d,b as W,c as y,d as v,f as C,g as E}from"./chunk-FEDAVPE7.js";var N=W((ue,_)=>{_.exports=Slick});var ee=W((qe,Z)=>{Z.exports=Serenity.Extensions});var c=y(E(),1),a=y(C(),1),te=y(N(),1);var f=y(E(),1),x=y(C(),1);var Q=y(E(),1),T=y(C(),1);var le=y(E(),1),H=y(C(),1);var A=y(C(),1);var oe=y(E(),1);function z(h,b=!0){h&&(b==!0?h.element.closest(".field").show():h.element.closest(".field").hide())}d(z,"showField");var L=y(E(),1);var U=null,j=!0,q={AutoColumnSize:!0,FadeInEffectWhenInit:!0,ShowAnyInEqualityFilterWithTextValue:!0,ShowInlineActionsColumn:!0,ShowDeleteInlineButtun:!1,ShowEditInlineButtun:!0,ShowPrintInlineButtun:!1,ShowRowNumberColumn:!0,ShowRowSelectionCheckboxColumn:!1,EnableQuickSearch:!0,RowsPerPage:20};var K={AutoFitContentArea:!1,HideCategoyLinksBar:!0,PendingChangesConfirmation:!0,ShowSaveAndNewButtonInToolbar:!1,ShowCloseButtonInToolbar:!1,ShowRefreshButtonInToolbar:!1,ShowChangeLogButtonInToolbar:!0,ShowReplaceRowButtonInToolbar:!1,ShowKeyboardLayoutButtonInToolbar:!1};function p(h,b){var e=H.text(h);return e==h?b:e}d(p,"text");var I=class extends Q.TemplatedDialog{constructor(e){super(e);this.onSuccess=d(e=>{},"onSuccess");try{var t=T.getType(e.gridType);this.checkGrid=new t(this.byId("RowSelectionCheckGrid"),e),e.preSelectedKeys&&(this.checkGrid.selectedKeys=e.preSelectedKeys),this.dialogTitle=p("Controls.Select","Select")+" - "+this.checkGrid.getTitle(),this.checkGrid.setTitle(null),this.checkGrid.element.height(500),this.checkGrid.pickerDialog=this}catch(s){console.warn("Could not intialize "+e.gridType)}}getTemplate(){return`<div id="~_RowSelectionCheckGrid" 
                class="RowSelectionCheckGrid ${this.options.multiple==!0?"multi-select":"single-select"}" 
                style = "margin: 15px 15px 0 15px;" >
            </div>`}get selectedItems(){return this.checkGrid.selectedItems}getDialogOptions(){let e=super.getDialogOptions();return e.buttons=[{text:T.text("Dialogs.OkButton"),click:()=>{var t=this.checkGrid.selectedItems;if(!t.length){T.notifyWarning("Please select some items!");return}this.onSuccess(t),this.dialogClose()}},{text:T.text("Dialogs.CancelButton"),click:()=>{this.dialogClose()}}],e.height=500,e}};d(I,"GridItemPickerDialog"),I=v([Q.Decorators.registerClass()],I);var k=class extends f.Widget{constructor(e,t){super(e,t);this.options=t;this.selectedItemIncludeColumns=[];this.importPagejs(t),this.element.addClass("select2-offscreen"),this.containerDiv=$(`<div class="editor s-GridItemPickerEditor select2-container ${t.multiple?"select2-container-multi":""} has-inplace-button">
                        <div class="${t.multiple?"select2-choices":"select2-choice"}">
                            <div class="display-text" style="user-select: text; padding-right: 20px;${t.multiple?"padding-left: 5px;":""}"></div>
                            <a class="select2-search-choice-close btn-clear-selection" style="margin-top: 2px; cursor: pointer; left: unset;"></a>
                        </div>
                    </div>`).insertBefore(this.element),this.addInplaceButtons(),this.setCascadeFrom(this.options.cascadeFrom)}importPagejs(e){let t=e.pageImportPath;t.startsWith("@/")&&(t="~/esm/Modules/"+t.substring(2),t.endsWith(".js")||(t+=".js")),t=x.resolveUrl(t),import(t)}addInplaceButtons(){var e=this;this.inplaceSearchButton=$('<a style="padding-top: 2px;"><i class="fa fa-search"></i></a>').addClass("inplace-button inplace-search align-center").attr("title","search").insertAfter(this.containerDiv).click(function(t){e.inplaceSearchClick(t)}),this.inplaceViewButton=$('<a style="padding-top: 2px;"><i class="fa fa-eye"></i></a>').addClass("inplace-button inplace-view align-center").attr("title","view").click(function(t){e.inplaceViewClick(t)}).hide(),this.options.inplaceView!=!1&&!this.options.multiple&&this.inplaceViewButton.insertAfter(this.containerDiv),this.clearSelectionButton=this.containerDiv.find(".select2-search-choice-close").click(t=>{this.value="",this.text="",this._selectedItem=null,this.selectedItems=[],$(t.target).hide(),this.element.trigger("change")}).hide()}inplaceSearchClick(e){this.options.preSelectedKeys=this.values;var t=new I(this.options);t.onSuccess=s=>{this.value=t.checkGrid.rowSelection.getSelectedKeys().join(","),this.text=s.map(o=>o[this.options.nameFieldInGridRow]).join(", "),x.isEmptyOrNull(this.text)&&console.warn("nameFieldInGridRow might be wrong in "+this.widgetName),this._selectedItem=s[0],this.selectedItems=s,this.element.trigger("change")},t.dialogOpen()}inplaceViewClick(e){var t=this.value;if(!x.isEmptyOrNull(t)){var s=this.getDialogInstance();s.isReadOnly=!0,s.loadByIdAndOpenDialog(t,!1)}}getDialogInstance(){var e=this.options.dialogType;e.prototype||(e=x.getType(this.options.dialogType));try{var t=new e;return t}catch(s){console.warn("Could not intialize "+this.options.dialogType)}}get value(){return this.element.val()}set value(e){this.element.val(e),x.isEmptyOrNull(e)?(this.text="",this.inplaceViewButton.hide(),this.clearSelectionButton.hide()):(this.inplaceViewButton.show(),this.get_readOnly()==!1&&this.clearSelectionButton.show())}get values(){let e=this.value;return x.isEmptyOrNull(e)?[]:e.split(",")}set values(e){this.value=e.join(",")}get text(){return this.containerDiv.find(".display-text").text()}set text(e){this.containerDiv.find(".display-text").text(e)}getEditValue(e,t){this.options.multiple==!0?t[e.name]=this.values:t[e.name]=this.value}setEditValue(e,t){this.value=e[t.name];let s=e[this.options.nameFieldInThisRow];this.text=s,e[t.name]&&(this._selectedItem={},this._selectedItem[this.options.idFieldInGridRow]=e[t.name],this._selectedItem[this.options.nameFieldInGridRow]=s)}get_value(){return this.value}set_value(e){this.value=e}get_readOnly(){return this.element.hasClass("readonly")}set_readOnly(e){e?(this.element.addClass("readonly"),this.containerDiv.addClass("select2-container-disabled"),this.inplaceSearchButton.addClass("disabled").hide(),this.clearSelectionButton.addClass("disabled").hide()):(this.element.removeClass("readonly"),this.containerDiv.removeClass("select2-container-disabled"),this.inplaceSearchButton.removeClass("disabled").show(),this.clearSelectionButton.removeClass("disabled").show())}get_required(){return this.element.hasClass("required")}set_required(e){e?(this.element.addClass("required"),this.containerDiv.addClass("required"),this.containerDiv.find(".select2-choice, display-text").addClass("required")):(this.element.removeClass("required"),this.containerDiv.removeClass("required"),this.containerDiv.find(".select2-choice, display-text").removeClass("required"))}get selectedItem(){if(this._selectedItem&&this._selectedItem[this.options.nameFieldInGridRow]&&this.selectedItemIncludeColumns.every(e=>this._selectedItem[e]))return this._selectedItem;if(!x.isEmptyOrNull(this.value))return x.serviceCall({service:this.serviceUrl+"/Retrieve",request:{EntityId:this.value,ColumnSelection:f.RetrieveColumnSelection.list,IncludeColumns:this.selectedItemIncludeColumns},async:!1,onSuccess:e=>{this._selectedItem=e.Entity}}),this._selectedItem}get serviceUrl(){if(x.isEmptyOrNull(this._serviceUrl)){var e=this.getDialogInstance();this._serviceUrl=e.getService()}return this._serviceUrl}setValueAndText(e,t){this.value=e,this.text=t}getCascadeFromValue(e){return f.EditorUtils.getValue(e)}setCascadeFrom(e){if(x.isEmptyOrNull(e)){this.cascadeLink!=null&&(this.cascadeLink.set_parentID(null),this.cascadeLink=null),this.options.cascadeFrom=null;return}this.cascadeLink=new f.CascadedWidgetLink(f.Widget,this,t=>{this.set_cascadeValue(this.getCascadeFromValue(t))}),this.cascadeLink.set_parentID(e),this.options.cascadeFrom=e}get_cascadeFrom(){return this.options.cascadeFrom}get cascadeFrom(){return this.get_cascadeFrom()}set_cascadeFrom(e){e!==this.options.cascadeFrom&&(this.setCascadeFrom(e),this.updateItems())}set cascadeFrom(e){this.set_cascadeFrom(e)}get_cascadeField(){return x.coalesce(this.options.cascadeField,this.options.cascadeFrom)}get cascadeField(){return this.get_cascadeField()}set_cascadeField(e){this.options.cascadeField=e}set cascadeField(e){this.set_cascadeField(e)}get_cascadeValue(){return this.options.cascadeValue}get cascadeValue(){return this.get_cascadeValue()}set_cascadeValue(e){this.options.cascadeValue!==e&&(this.options.cascadeValue=e,this.set_value(null),this.updateItems())}set cascadeValue(e){this.set_cascadeValue(e)}get_filterField(){return this.options.filterField}get filterField(){return this.get_filterField()}set_filterField(e){this.options.filterField=e}set filterField(e){this.set_filterField(e)}get_filterValue(){return this.options.filterValue}get filterValue(){return this.get_filterValue()}set_filterValue(e){this.options.filterValue!==e&&(this.options.filterValue=e,this.set_value(null),this.updateItems())}set filterValue(e){this.set_filterValue(e)}updateItems(){}};d(k,"GridItemPickerEditor"),k=v([f.Decorators.registerEditor("_Ext.GridItemPickerEditor",[f.ISetEditValue,f.IGetEditValue,f.IStringValue,f.IReadOnly,f.IValidateRequired]),f.Decorators.element('<input type="text" />')],k);var M=y(C(),1);function J(h){$.ajax({url:h,dataType:"script",async:!1,cache:!0,success:function(){},error:function(){throw new Error("Could not load script "+h)}})}d(J,"loadScript");function Y(){window.Slick&&window.Slick.Editors&&window.Slick.Editors.Text||J(M.resolveUrl("~/lib/_Ext/Editors/slick.editors.js"))}d(Y,"usingSlickGridEditors");function X(){window.Slick&&window.Slick.AutoColumnSize||J(M.resolveUrl("~/lib/_Ext/CustomSlickGridPlugin/slick.autocolumnsize.js"))}d(X,"usingSlickAutoColumnSize");var G=y(ee(),1);var F=class extends c.EntityGrid{constructor(e,t){super(e,t);this.isAutosized=!1;this.isChildGrid=!1;this.nextRowNumber=1;this.rowSelection=new c.GridRowSelectionMixin(this);this.get_ExtGridOptions().AutoColumnSize==!0&&this.slickContainer.fadeTo(0,0);let o=this.getGrouping();o.length>0&&this.setGrouping(o)}get_ExtGridOptions(){return a.deepClone(q)}isPickerMode(){return this.element.hasClass("RowSelectionCheckGrid")}getGrouping(){return[]}markupReady(){super.markupReady(),setTimeout(()=>{this.isAutosized==!1&&(this.get_ExtGridOptions().AutoColumnSize==!0&&this.resizeAllCulumn(),this.slickContainer.fadeTo(100,1))},100)}getButtons(){var e=super.getButtons();let t=this.getReportRequest();return t.ListExcelServiceMethodName&&e.push(G.ExcelExportHelper.createToolButton({grid:this,service:this.getService()+"/"+t.ListExcelServiceMethodName,onViewSubmit:()=>this.onViewSubmit(),separator:!0})),t.ReportKey?(e.push({title:p("Controls.ExportToPDF","Export to PDF"),icon:"fa fa-file-pdf-o",onClick:()=>{let s=this.getReportRequest();s&&G.ReportHelper.execute({reportKey:t.ReportKey,params:{request:s}})}}),e.push({title:p("Controls.ViewAsReport","View as Report"),icon:"fa fa-html5",onClick:()=>{let s=this.getReportRequest();s&&G.ReportHelper.execute({reportKey:t.ReportKey,params:{request:s},extension:"html"})}})):t.ReportServiceMethodName&&e.push({title:p("Controls.ViewAsReport","View as Report"),icon:"fa fa-eye",onClick:()=>{let s=this.getReportRequest();s&&a.postToService({service:a.resolveUrl(this.getService()+"/"+t.ReportServiceMethodName),request:s,target:"_blank"})}}),e}getReportRequest(){let e=this.getView();var t=a.deepClone(e?e.params:{});if(t.ReportServiceMethodName=null,t.ReportKey=null,t.ListExcelServiceMethodName=U,t.EqualityFilterWithTextValue={},t.CustomParameters={},e){let o=this.getQuickFilters();for(let i of o){let n=t.EqualityFilter[i.field];if(n&&n.length>0)if(i.options.lookupKey){let u=a.getLookup(i.options.lookupKey);t.EqualityFilterWithTextValue[i.title]=u.itemById[n][u.textField]}else if(i.options.enumKey){let u=i.options.enumKey,m=a.toId(n);t.EqualityFilterWithTextValue[i.title]=c.EnumFormatter.format(c.EnumTypeRegistry.get(u),m)}else if(i.type==k){var s=this.findQuickFilter(k,i.field);t.EqualityFilterWithTextValue[i.title]=s.text}else t.EqualityFilterWithTextValue[i.title]=n;else if(i.type==c.DateEditor){let u=this.findQuickFilter(c.DateEditor,i.field),m=u.element.val(),r=u.element.siblings("input").val(),l="";a.isEmptyOrNull(m)||(l=a.format(p("Controls.FromDate","From {0}"),m)+" "),a.isEmptyOrNull(r)||(l=l+a.format(p("Controls.ToDate","To {0}"),r)),a.isEmptyOrNull(l)?this.get_ExtGridOptions().ShowAnyInEqualityFilterWithTextValue==!0&&(t.EqualityFilterWithTextValue[i.title]=p("Controls.All","all")):t.EqualityFilterWithTextValue[i.title]=l}else this.get_ExtGridOptions().ShowAnyInEqualityFilterWithTextValue==!0&&(t.EqualityFilterWithTextValue[i.title]=p("Controls.All","all"))}if(this.filterBar){let i=this.filterBar.get_store().get_displayText();a.isEmptyOrNull(i)||(t.EqualityFilterWithTextValue[a.text("Controls.FilterPanel.EditFilter")]=i)}}return t}getColumns(){let e=super.getColumns(),t=this.getSlickOptions().editable,s=this.get_ExtGridOptions();if(t==!0&&Y(),e.forEach(i=>{let n=i.cssClass||"",u=i.minWidth||i.width||50;if(i.sourceItem){let m=i.sourceItem.formatterType;i.sourceItem.filteringType=="Lookup"?(n=" align-left",u=i.minWidth>100?i.minWidth:100):m=="Enum"?u=i.minWidth>100?i.minWidth:100:m=="Date"?(n=" align-center",u=i.minWidth>99?i.minWidth:99):m=="DateTime"?(n=" align-center",u=i.minWidth>140?i.minWidth:140):m=="Number"?n=" align-right":m=="Checkbox"?n=" align-center":(n=" align-left",u=i.minWidth>99?i.minWidth:99);let r=i.sourceItem.placeholder=="Controls.All"?p("Controls.All","All"):"-";if(i.sourceItem.editorType=="Lookup")i.sourceItem.editorParams.autoComplete||(i.format=l=>{let g=a.getLookup(i.sourceItem.editorParams.lookupKey);if(l.column.sourceItem.editorParams.multiple==!0){if(l.value){let O=l.value.map(R=>g.itemById[R]).map(R=>R[g.textField]);return O.length>0?O.join(", "):r}}else{let S=g.itemById[l.value];return S?S[g.textField]:r}});else if(i.sourceItem.editorType=="ServiceLookup")i.sourceItem.editorParams.autoComplete||(i.format=l=>{let g=i.sourceItem.editorParams.textFieldInThisRow||i.sourceItem.editorParams.textField;return l.item?l.item[g]:r});else if(i.sourceItem.filteringType=="Lookup")i.format=l=>a.isEmptyOrNull(l.value)?r:l.value;else if(m=="Enum")i.format=l=>{let g=l.column.sourceItem.editorParams.enumKey;if(l.column.sourceItem.editorParams.multiple==!0){let S="",O=l.value;return O&&O.length>0&&(S=O.map(R=>c.EnumFormatter.format(c.EnumTypeRegistry.get(g),a.toId(R))).join(", ")),S||r}else{let S=c.EnumFormatter.format(c.EnumTypeRegistry.get(g),a.toId(l.value));return S||r}};else if(i.sourceItem.editorType=="Decimal"){let l="#,##0.00";if(i.sourceItem.editorParams){let g=i.sourceItem.editorParams.decimals;if(g){l="#,##0.";for(let S=0;S<g;S++)l+="0"}else if(i.sourceItem.editorParams.minValue){let S=i.sourceItem.editorParams.minValue.split(".");S.length>1?l="#,##0."+S[1]:l="#,##0"}}i.format=g=>c.NumberFormatter.format(g.value,l)}if(t==!0&&i.sourceItem.readOnly!=!0)if(j)i.editor=SerenityInlineEditor;else{let l=i.sourceItem.editorType;l=="Lookup"||l=="Enum"?(i.editor=Slick.Editors.Select2,u=i.minWidth>160?i.minWidth:160):l=="Date"?i.editor=Slick.Editors.Date:l=="Boolean"?i.editor=Slick.Editors.Checkbox:l=="Integer"?i.editor=Slick.Editors.Integer:l=="Decimal"?i.editor=Slick.Editors.Float:l=="YesNoSelect"?i.editor=Slick.Editors.YesNoSelect:l=="PercentComplete"?i.editor=Slick.Editors.PercentComplete:l=="LongText"?i.editor=Slick.Editors.LongText:i.editor=Slick.Editors.Text}}i.cssClass+=n,this.get_ExtGridOptions().AutoColumnSize==!0&&(i.width=u)}),e.unshift({field:"RowNum",name:"#",cssClass:"rownum-column",headerCssClass:"align-center",width:40,minWidth:40,maxWidth:40,visible:s.ShowRowNumberColumn,format:i=>(i.item.RowNum||(i.item.RowNum=this.nextRowNumber++),String(i.item.RowNum))}),s.ShowInlineActionsColumn==!0){let i=0,n="";if(s.ShowEditInlineButtun==!0){i+=32;var o=this.isReadOnly?p("Controls.View","View Details"):p("Controls.Edit","Edit");n+=`<a class="inline-actions view-details" title="${o}" style="font-size: 1.2em;"><i class="view-details fa fa-pencil-square-o"></i></a>`}s.ShowDeleteInlineButtun==!0&&(i+=22,n+=`<a class="inline-actions delete-row" title="${p("Controls.Delete","Delete")}" style="padding-left: 5px;"><i class="delete-row fa fa-trash-o text-red"></i></a>`),s.ShowPrintInlineButtun==!0&&(i+=25,n+=`<a class="inline-actions print-row" title="${p("Controls.Print","Print")}" style="padding-left: 5px;"><i class="print-row fa fa-print"></i></a>`),e.unshift({field:"inline-actions",name:"",cssClass:"inline-actions-column",width:i,minWidth:i,maxWidth:i,formatter:(u,m,r,l,g)=>n})}if(s.ShowRowSelectionCheckboxColumn==!0){let i=c.GridRowSelectionMixin.createSelectColumn(()=>this.rowSelection);i.width=i.minWidth=i.maxWidth=27,e.unshift(i)}if(this.isPickerMode()){let i=this.options;if(!i.multiple&&!i.gridType&&a.notifyWarning("Could not determine multiple/single. Probably there is no 'options' parameter in grid's constructor."),e.forEach(n=>{n.sourceItem&&n.sourceItem.editLink&&(n.format=void 0)}),i.multiple==!0){let n=c.GridRowSelectionMixin.createSelectColumn(()=>this.rowSelection);n.width=n.minWidth=n.maxWidth=27,e.unshift(n)}else e.unshift({field:"row-selection",name:"",cssClass:"inline-actions-column",width:66,minWidth:66,maxWidth:66,format:n=>'<a class="inline-actions select-row"><i class="select-row fa fa-check"></i> Select</a>'})}return e}createSlickGrid(){var e=super.createSlickGrid();return X(),Slick.AutoColumnSize&&(this.autoColumnSizePlugin=new Slick.AutoColumnSize,e.registerPlugin(this.autoColumnSizePlugin)),e.registerPlugin(new te.GroupItemMetadataProvider),e}resetColumns(e){this.slickContainer.fadeTo(0,0),this.slickGrid.setColumns(e),setTimeout(()=>{this.get_ExtGridOptions().AutoColumnSize==!0&&this.resizeAllCulumn(),this.slickContainer.fadeTo(100,1)},100)}resizeAllCulumn(){this.isAutosized=!0;let e=this.slickContainer.width();e>0||(e=this.element.closest(".s-Dialog").width()-55),e>0||(e=this.element.closest(".s-Panel").width()-55),e>0||(e=$("section.content").width()-75),this.slickGrid.setOptions({forceFitColumns:!1});let t=this.autoColumnSizePlugin.resizeAllColumns().filter(o=>o.visible!=!1),s=0;if(t.map(o=>o.width).forEach(o=>s+=o),s>e)this.autoColumnSizePlugin.resizeAllColumns();else if(s<e){this.autoColumnSizePlugin.resizeAllColumns();let o=[],i=[];t.forEach(r=>{r.minWidth==r.maxWidth?(o.push(r),r.width=r.maxWidth):r.cssClass&&r.cssClass.indexOf("no-auto-size")>=0?o.push(r):r.sourceItem?r.sourceItem.formatterType==String("Number")?o.push(r):r.sourceItem.filteringType==String("Enum")||r.sourceItem.formatterType==String("Date")?(o.push(r),r.width<80&&(r.width=80)):r.sourceItem.formatterType==String("DateTime")?(o.push(r),r.width<150&&(r.width=150)):r.sourceItem.formatterType==String("Checkbox")?o.push(r):i.push(r):i.push(r)}),i.length==0&&(o=[],i=[],t.forEach(r=>{r.minWidth==r.maxWidth?(o.push(r),r.width=r.maxWidth):i.push(r)}));let n=0;o.map(r=>r.width).forEach(r=>n+=r);let u=e-n-(this.isChildGrid?48:18),m=0;i.map(r=>r.width).forEach(r=>m+=r),i.forEach(r=>{let l=u/m,g=r.width*l,S=g-r.width;r.width=g}),this.slickGrid.setColumns(t),this.slickGrid.onColumnsResized.notify()}this.setItems(this.getItems())}getSlickOptions(){let e=super.getSlickOptions();return this.get_ExtGridOptions().AutoColumnSize==!0&&(e.forceFitColumns=!0),e.enableTextSelectionOnCells=!0,e.enableCellNavigation=!0,e.asyncEditorLoading=!1,e.autoEdit=!0,e.rowHeight=27,e}getViewOptions(){let e=super.getViewOptions();return this.usePager()&&(e.rowsPerPage=q.RowsPerPage),e}getPrintRowServiceMethod(){return"Print"}onClick(e,t,s){if(super.onClick(e,t,s),e.isDefaultPrevented())return;var o=this.itemAt(t);let i=o[this.getIdProperty()];var n=$(e.target);(n.parent().hasClass("inline-action")||n.parent().hasClass("inline-actions")||n.parent().hasClass("inline-btn"))&&(n=n.parent()),(n.hasClass("inline-action")||n.hasClass("inline-actions")||n.hasClass("inline-btn"))&&this.onInlineActionClick(n,i,o)}onInlineActionClick(e,t,s){if(e.hasClass("delete-row"))this.isReadOnly==!0?a.notifyWarning("Read only records could not be deleted!"):a.confirm(p("Db.Administration.Translation.DeleteWarning","Delete record?"),()=>{let o=this;o.deleteEntity?o.deleteEntity(t):a.serviceRequest(this.getService()+"/Delete",{EntityId:t},i=>{this.refresh()})});else if(e.hasClass("view-details"))this.slickGrid.getEditController().commitCurrentEdit(),this.editItem(t);else if(e.hasClass("print-row")){let o={EntityId:t};a.postToService({service:a.resolveUrl(this.getService()+"/"+this.getPrintRowServiceMethod()),request:o,target:"_blank"})}else e.hasClass("select-row")&&(this.rowSelection.setSelectedKeys([t]),this.pickerDialog.onSuccess(this.selectedItems),this.pickerDialog.dialogClose())}resetRowNumber(){this.nextRowNumber=1;let e=this.getItems(),t=this.view.getGrouping();if(t.length==0)for(let s=0;s<e.length;s++)e[s].RowNum=s+1;else if(t.length>0){let s=d(i=>{for(let n=0;n<i.length;n++){let u=i[n].groups;if(u)s(u);else{let m=i[n].rows;for(let r=0;r<m.length;r++)m[r].RowNum=r+1}}},"generateRowNumber"),o=this.view.getGroups();s(o)}this.setItems(e)}setGrouping(e){this.view.setGrouping(e),this.resetRowNumber()}getIncludeColumns(e){super.getIncludeColumns(e);let t=this.getGrouping();t.length>0&&t.forEach(s=>e[s.getter]=!0)}getDefaultSortBy(){let e=super.getDefaultSortBy(),t=this.getGrouping();return t.length>0&&t.forEach(s=>e.unshift(s.getter)),e}onViewProcessData(e){let t=super.onViewProcessData(e);return this.get_ExtGridOptions().ShowRowNumberColumn==!0&&setTimeout(()=>{this.resetRowNumber()}),t}initDialog(e){super.initDialog(e),e.parentGrid=this}get selectedItems(){return this.rowSelection.getSelectedKeys().map(e=>{let t=this.view.getItemById(e);return t||(t={},t[this.getIdProperty()]=e),t})}set selectedKeys(e){this.options.multiple==!0&&this.rowSelection.setSelectedKeys(e)}onViewSubmit(){if(!super.onViewSubmit())return!1;var e=this.view.params;let t=this.options;t.filteringCriteria&&(e.Criteria=c.Criteria.and(e.Criteria,t.filteringCriteria)),t.filterField&&a.isValue(t.filterValue)&&(e.EqualityFilter=e.EqualityFilter||{},e.EqualityFilter[t.filterField]=t.filterValue);let s=t.cascadeField||t.cascadeFrom;return s&&a.isValue(t.cascadeValue)&&(e.EqualityFilter=e.EqualityFilter||{},e.EqualityFilter[s]=t.cascadeValue),!0}};d(F,"GridBase"),F=v([c.Decorators.filterable()],F);var w=y(E(),1),D=y(C(),1);var V=y(E(),1),ie=y(C(),1);function re(h,b){h.on("dialogbeforeclose panelbeforeclose",function(e){!V.WX.hasOriginalEvent(e)||!b()||(e.preventDefault(),ie.confirm(p("Controls.EntityDialog.PendingChangesConfirmation","You have pending changes. Save them?"),()=>h.find("div.save-and-close-button").click(),{onNo:function(){h.hasClass("ui-dialog-content")?h.dialog("close"):h.hasClass("s-Panel")&&V.TemplatedDialog.closePanel(h)}}))})}d(re,"pendingChangesConfirmation");var se=y(C(),1);function de(){return(0,se.getRemoteData)("UserData")}d(de,"userDefinition");function ne(h){let b=de();return b.Username==="admin"||!!b.Permissions[h]}d(ne,"hasPermission");var B=class extends w.EntityDialog{constructor(e){super(e);this.isReadOnly=!1;this.get_ExtDialogOptions().PendingChangesConfirmation==!0&&re(this.element,()=>this.getSaveState()!=this.loadedState)}get_ExtDialogOptions(){return D.deepClone(K)}getTenantIdEditor(){return this.form.TenantId}updateInterface(){super.updateInterface(),this.setReadOnly(this.isReadOnly),z(this.getTenantIdEditor(),ne("Administration:Tenant:Update"))}onDialogOpen(){super.onDialogOpen();let e=this.get_ExtDialogOptions();if(e.AutoFitContentArea==!0&&this.fullContentArea(),e.HideCategoyLinksBar==!0){this.element.find(".category-links").hide();let t=this.element.find(".first-category > .category-title");D.isEmptyOrNull(t.find(".category-anchor").text())&&t.hide()}if(e.ShowKeyboardLayoutButtonInToolbar==!0){let t=this.element}setTimeout(()=>{this.onAfterSetDialogSize()},200)}onDialogClose(){super.onDialogClose(),this.onAfterDialogClose(this.getSaveEntity())}setReadOnly(e){if(this.readOnly=e,this.isReadOnly=e,this.isReadOnly==!0){this.saveAndCloseButton.toggleClass("disabled",this.isReadOnly),this.applyChangesButton.toggleClass("disabled",this.isReadOnly),this.deleteButton.toggleClass("disabled",this.isReadOnly),this.cloneButton.toggleClass("disabled",this.isReadOnly),this.undeleteButton.toggleClass("disabled",this.isReadOnly),this.toolbar.findButton("btn-save-and-close").addClass("disabled"),this.toolbar.findButton("btn-save-and-new").addClass("disabled"),this.toolbar.findButton("btn-replace-row").addClass("disabled"),this.toolbar.findButton("btn-history").addClass("disabled"),this.toolbar.findButton("btn-custom").addClass("disabled"),this.element.find("sup").toggle(this.isReadOnly);for(let t in this.form)if(this.form[t].widgetName)try{w.EditorUtils.setReadOnly(this.form[t],this.isReadOnly)}catch(s){}}}getToolbarButtons(){let e=super.getToolbarButtons(),t=this.get_ExtDialogOptions();t.ShowSaveAndNewButtonInToolbar==!0&&e.push({title:p("Controls.EntityDialog.SaveAndNew","Save & New"),icon:"fa fa-save",cssClass:"btn-save-and-new",onClick:()=>{this.onSaveAndNewButtonClick()}}),t.ShowCloseButtonInToolbar==!0&&e.push({title:p("Controls.EntityDialog.Close","Close"),icon:"fa fa-close",cssClass:"btn-close",onClick:()=>{this.dialogClose()}}),t.ShowRefreshButtonInToolbar==!0&&e.push({title:p("Controls.EntityDialog.Refresh","Refresh"),icon:"fa fa-refresh",onClick:()=>{this.onRefreshClick()}});try{let s=D.tryFirst(e,o=>o.cssClass=="clone-button");s.onClick=()=>{if(this.isEditMode()){var o=this.getCloningEntity();w.Widget.create({type:D.getInstanceType(this),init:i=>{this.parentGrid.initDialog(i),i.loadEntityAndOpenDialog(o,null)}}),this.dialogClose()}}}catch(s){}return e}onRefreshClick(){this.reloadById()}onSaveAndNewButtonClick(){this.save(e=>{this.loadEntity({})})}getSaveState(){try{return $.toJSON(this.getSaveEntity())}catch(e){return null}}onSaveSuccess(e){super.onSaveSuccess(e)}loadResponse(e){super.loadResponse(e),this.get_ExtDialogOptions().PendingChangesConfirmation==!0&&(this.loadedState=this.getSaveState())}maximize(){this.element.closest(".ui-dialog").find(".ui-dialog-titlebar-maximize").click(),setTimeout(()=>{let e=this.element?this.element.closest(".ui-dialog"):$(".ui-dialog"),t=e.height(),s=e.find(".ui-dialog-title").height()||20,o=this.element.find(".categories"),i=o.position().top;o.height(t-s-i-20)},100)}fullContentArea(){window.innerWidth>768&&this.setDialogSize()}setDialogSize(e,t,s,o,i){i||(i=$("section.content")),i.length==0&&(i=$(".content-wrapper"));let n=this.element?this.element.closest(".ui-dialog"):$(".ui-dialog");if(i.length>0&&n.length>0){let u=i.width()+28+(e||0),m=i.height()+(t||30);this.element.dialog("option","width",u),this.element.dialog("option","height",m);let r=n.find(".ui-dialog-title").height()||20,l=this.element.find(".categories"),g=l.position().top;l.height(m-r-g-20),n.css({left:i.position().left+(o||2),top:s||50})}setTimeout(()=>{this.onAfterSetDialogSize()},200)}onAfterSetDialogSize(){}onAfterDialogClose(e){}};d(B,"DialogBase"),B=v([w.Decorators.responsive(),w.Decorators.maximizable()],B);export{B as a,F as b};
//# sourceMappingURL=chunk-LKL4UBNM.js.map
